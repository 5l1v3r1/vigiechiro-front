<div>
  <div>
    <b>{{ donnee.titre }}</b>

    <a class="btn btn-default"
       ng-click="CopyToClipboard('{{donnee.titre}}')">
      Copier
    </a>

    <a class="btn btn-warning" ng-click="editDonnee()">Modifier</a>
  </div>
  <div class="label label-success" ng-show="copySuccess">
    Titre copié avec succès
  </div>

  <div>
    <p>{{ donnee.commentaire }}</p>
    <p>{{ donnee.probleme }}</p>
  </div>

  <div class="table-responsive" ng-show="donnee.observations">
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th></th>
          <th>Taxon Tadarida</th>
          <th>Probabilité</th>
          <th>Taxon observateur</th>
          <th>Confiance observateur</th>
          <th>Taxon validateur</th>
          <th>Confiance validateur</th>
          <th>FreqM</th>
          <th>TDeb</th>
          <th>TFin</th>
        </tr>
      </thead>

      <tbody ng-repeat="(key, observation) in donnee.observations">
        <tr>
          <td class="btn" data-toggle="collapse"
              data-target="#{{donnee.titre}}-{{$index}}">
            <span class="glyphicon glyphicon-collapse-down">
            </span>
          </td>
          <td>{{ observation.tadarida_taxon.libelle_long }}</td>
          <td>{{ observation.tadarida_probabilite }}</td>
          <!-- Taxon observateur -->
          <td>
            <div class="input-group input-group-sm">
              <ui-select ng-model="observation.observateur_taxon"
                         theme="bootstrap"
                         ng-disabled="!isObservateur"
                         append-to-body>
                <ui-select-match>{{$select.selected.libelle_long}}</ui-select-match>
                <ui-select-choices repeat="taxon._id as taxon in taxons | filter: $select.search">
                  {{taxon.libelle_long}}
                </ui-select-choices>
              </ui-select>
            </div>
          </td>
          <!-- Confiance observateur -->
          <td>
            <div class="input-group input-group-sm">
              <select class="form-control"
                      ng-model="observation.observateur_probabilite"
                      ng-disabled="!isObservateur">
                <option value="SUR">Sûr</option>
                <option value="PROBABLE">Probable</option>
                <option value="POSSIBLE">Possible</option>
              </select>
              <a class="input-group-addon" href=""
                 ng-click="patchObservateur(key)" ng-show="true">OK</a>
            </div>
          </td>
          <!-- Taxon validateur -->
          <td>
            <div class="input-group input-group-sm">
              <ui-select ng-model="observation.validateur_taxon"
                         theme="bootstrap"
                         ng-disabled="!isValidateur"
                         append-to-body>
                <ui-select-match>{{$select.selected.libelle_long}}</ui-select-match>
                <ui-select-choices repeat="taxon._id as taxon in taxons | filter: $select.search">
                  {{taxon.libelle_long}}
                </ui-select-choices>
              </ui-select>
            </div>
          </td>
          <!-- Confiance validateur -->
          <td>
            <div class="input-group input-group-sm">
              <select class="form-control"
                      ng-model="observation.validateur_probabilite"
                      ng-disabled="!isValidateur">
                <option value="SUR">Sûr</option>
                <option value="PROBABLE">Probable</option>
                <option value="POSSIBLE">Possible</option>
              </select>
              <a class="input-group-addon" href=""
                 ng-click="patchValidateur(key)" ng-show="true">OK</a>
            </div>
          </td>
          <td>{{observation.frequence_mediane}}</td>
          <td>{{observation.temps_debut}}</td>
          <td>{{observation.temps_fin}}</td>
        </tr>
        <tr class="label label-danger" ng-show="patchError">
          Echec de l'enregistrement des modifications.
        </tr>
        <tr class="collapse" id="{{donnee.titre}}-{{$index}}"><td colspan="7">
          <p><b>Autre taxon Tadarida :</b></p>
          <div ng-repeat="autre in observation.tadarida_taxon_autre"
               ng-show="autre.probabilite >= observation.tadarida_probabilite/2.1">
            {{ autre.taxon.libelle_long }} : {{autre.probabilite }}
          </div>
          <p><b>Messages :</b></p>
          <div ng-repeat="message in observation.messages"
               ng-show="observation.messages.length">
            Auteur : {{ message.auteur.pseudo }}
            <br>
            Date : {{ message.date | xinDate: 'medium' }}
            <br>
            Message : {{ message.message }}
          </div>
          <div ng-show="!observation.messages ||observation.messages.length == 0">
            Pas de message pour le moment.
          </div>
          <div class="form-group input-group">
            <input class="form-control" type="text" ng-model="newPost">
            {{ observation.newPost }}
            <a class="input-group-addon" ng-click="addPost({{$index}}, newPost)">
              Ajouter un message
            </a>
          </div>
        </td></tr>
      </tbody>
    </table>
  </div>

  <div ng-show="!donnee.observations">
    Pas d'observation pour le moment.
  </div>
</div>
